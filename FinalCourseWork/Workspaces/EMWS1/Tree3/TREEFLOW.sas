****************************************************************;
******             DECISION TREE SCORING CODE             ******;
****************************************************************;

******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
LENGTH F_ORGYN  $   12; 
LENGTH I_ORGYN  $   12; 
LENGTH _WARN_  $    4; 

******              LABELS FOR NEW VARIABLES              ******;
label _NODE_ = 'Node' ;
label _LEAF_ = 'Leaf' ;
label P_ORGYN1 = 'Predicted: ORGYN=1' ;
label P_ORGYN0 = 'Predicted: ORGYN=0' ;
label Q_ORGYN1 = 'Unadjusted P: ORGYN=1' ;
label Q_ORGYN0 = 'Unadjusted P: ORGYN=0' ;
label V_ORGYN1 = 'Validated: ORGYN=1' ;
label V_ORGYN0 = 'Validated: ORGYN=0' ;
label R_ORGYN1 = 'Residual: ORGYN=1' ;
label R_ORGYN0 = 'Residual: ORGYN=0' ;
label F_ORGYN = 'From: ORGYN' ;
label I_ORGYN = 'Into: ORGYN' ;
label U_ORGYN = 'Unnormalized Into: ORGYN' ;
label _WARN_ = 'Warnings' ;


******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12; 
_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1; 
_ARBFMT_1 = ' '; /* Initialize to avoid warning. */


_ARBFMT_12 = PUT( ORGYN , BEST12.);
 %DMNORMCP( _ARBFMT_12, F_ORGYN );

******             ASSIGN OBSERVATION TO NODE             ******;
IF  NOT MISSING(AGE ) AND 
  AGE  <                 39.5 THEN DO;
  _ARBFMT_1 = PUT( GENDER , $1.);
   %DMNORMIP( _ARBFMT_1);
  IF _ARBFMT_1 IN ('F' ) THEN DO;
    _NODE_  =                    5;
    _LEAF_  =                    1;
    P_ORGYN1  =     0.69696969696969;
    P_ORGYN0  =      0.3030303030303;
    Q_ORGYN1  =     0.69696969696969;
    Q_ORGYN0  =      0.3030303030303;
    V_ORGYN1  =     0.73404255319148;
    V_ORGYN0  =     0.26595744680851;
    I_ORGYN  = '1' ;
    U_ORGYN  =                    1;
    END;
  ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
    IF  NOT MISSING(AFFL ) AND 
                      10.5 <= AFFL  THEN DO;
      _NODE_  =                   17;
      _LEAF_  =                    3;
      P_ORGYN1  =     0.73684210526315;
      P_ORGYN0  =     0.26315789473684;
      Q_ORGYN1  =     0.73684210526315;
      Q_ORGYN0  =     0.26315789473684;
      V_ORGYN1  =                0.625;
      V_ORGYN0  =                0.375;
      I_ORGYN  = '1' ;
      U_ORGYN  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   16;
      _LEAF_  =                    2;
      P_ORGYN1  =     0.30681818181818;
      P_ORGYN0  =     0.69318181818181;
      Q_ORGYN1  =     0.30681818181818;
      Q_ORGYN0  =     0.69318181818181;
      V_ORGYN1  =     0.35365853658536;
      V_ORGYN0  =     0.64634146341463;
      I_ORGYN  = '0' ;
      U_ORGYN  =                    0;
      END;
    END;
  ELSE DO;
    _NODE_  =                    7;
    _LEAF_  =                    4;
    P_ORGYN1  =     0.19402985074626;
    P_ORGYN0  =     0.80597014925373;
    Q_ORGYN1  =     0.19402985074626;
    Q_ORGYN0  =     0.80597014925373;
    V_ORGYN1  =     0.32786885245901;
    V_ORGYN0  =     0.67213114754098;
    I_ORGYN  = '0' ;
    U_ORGYN  =                    0;
    END;
  END;
ELSE IF  NOT MISSING(AGE ) AND 
                  39.5 <= AGE  AND
  AGE  <                 44.5 THEN DO;
  IF  NOT MISSING(AFFL ) AND 
    AFFL  <                  9.5 THEN DO;
    _NODE_  =                    8;
    _LEAF_  =                    5;
    P_ORGYN1  =     0.25462962962962;
    P_ORGYN0  =     0.74537037037037;
    Q_ORGYN1  =     0.25462962962962;
    Q_ORGYN0  =     0.74537037037037;
    V_ORGYN1  =     0.25850340136054;
    V_ORGYN0  =     0.74149659863945;
    I_ORGYN  = '0' ;
    U_ORGYN  =                    0;
    END;
  ELSE IF  NOT MISSING(AFFL ) AND 
                    15.5 <= AFFL  THEN DO;
    _NODE_  =                   10;
    _LEAF_  =                    8;
    P_ORGYN1  =     0.94444444444444;
    P_ORGYN0  =     0.05555555555555;
    Q_ORGYN1  =     0.94444444444444;
    Q_ORGYN0  =     0.05555555555555;
    V_ORGYN1  =     0.85714285714285;
    V_ORGYN0  =     0.14285714285714;
    I_ORGYN  = '1' ;
    U_ORGYN  =                    1;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( GENDER , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   18;
      _LEAF_  =                    6;
      P_ORGYN1  =     0.66666666666666;
      P_ORGYN0  =     0.33333333333333;
      Q_ORGYN1  =     0.66666666666666;
      Q_ORGYN0  =     0.33333333333333;
      V_ORGYN1  =     0.67213114754098;
      V_ORGYN0  =     0.32786885245901;
      I_ORGYN  = '1' ;
      U_ORGYN  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   19;
      _LEAF_  =                    7;
      P_ORGYN1  =     0.34545454545454;
      P_ORGYN0  =     0.65454545454545;
      Q_ORGYN1  =     0.34545454545454;
      Q_ORGYN0  =     0.65454545454545;
      V_ORGYN1  =     0.43589743589743;
      V_ORGYN0  =     0.56410256410256;
      I_ORGYN  = '0' ;
      U_ORGYN  =                    0;
      END;
    END;
  END;
ELSE DO;
  IF  NOT MISSING(AFFL ) AND 
    AFFL  <                  8.5 THEN DO;
    _NODE_  =                   11;
    _LEAF_  =                    9;
    P_ORGYN1  =     0.07707006369426;
    P_ORGYN0  =     0.92292993630573;
    Q_ORGYN1  =     0.07707006369426;
    Q_ORGYN0  =     0.92292993630573;
    V_ORGYN1  =     0.08198121263877;
    V_ORGYN0  =     0.91801878736122;
    I_ORGYN  = '0' ;
    U_ORGYN  =                    0;
    END;
  ELSE IF  NOT MISSING(AFFL ) AND 
                    12.5 <= AFFL  THEN DO;
    IF  NOT MISSING(AFFL ) AND 
                      17.5 <= AFFL  THEN DO;
      _NODE_  =                   25;
      _LEAF_  =                   13;
      P_ORGYN1  =      0.9090909090909;
      P_ORGYN0  =     0.09090909090909;
      Q_ORGYN1  =      0.9090909090909;
      Q_ORGYN0  =     0.09090909090909;
      V_ORGYN1  =                 0.95;
      V_ORGYN0  =                 0.05;
      I_ORGYN  = '1' ;
      U_ORGYN  =                    1;
      END;
    ELSE DO;
      _ARBFMT_1 = PUT( GENDER , $1.);
       %DMNORMIP( _ARBFMT_1);
      IF _ARBFMT_1 IN ('F' ) THEN DO;
        _NODE_  =                   32;
        _LEAF_  =                   11;
        P_ORGYN1  =     0.51764705882352;
        P_ORGYN0  =     0.48235294117647;
        Q_ORGYN1  =     0.51764705882352;
        Q_ORGYN0  =     0.48235294117647;
        V_ORGYN1  =     0.52678571428571;
        V_ORGYN0  =     0.47321428571428;
        I_ORGYN  = '1' ;
        U_ORGYN  =                    1;
        END;
      ELSE DO;
        _NODE_  =                   33;
        _LEAF_  =                   12;
        P_ORGYN1  =     0.25773195876288;
        P_ORGYN0  =     0.74226804123711;
        Q_ORGYN1  =     0.25773195876288;
        Q_ORGYN0  =     0.74226804123711;
        V_ORGYN1  =      0.2289156626506;
        V_ORGYN0  =     0.77108433734939;
        I_ORGYN  = '0' ;
        U_ORGYN  =                    0;
        END;
      END;
    END;
  ELSE DO;
    _NODE_  =                   12;
    _LEAF_  =                   10;
    P_ORGYN1  =     0.17847769028871;
    P_ORGYN0  =     0.82152230971128;
    Q_ORGYN1  =     0.17847769028871;
    Q_ORGYN0  =     0.82152230971128;
    V_ORGYN1  =     0.17075892857142;
    V_ORGYN0  =     0.82924107142857;
    I_ORGYN  = '0' ;
    U_ORGYN  =                    0;
    END;
  END;

*****  RESIDUALS R_ *************;
IF  F_ORGYN  NE '1' 
AND F_ORGYN  NE '0'  THEN DO; 
        R_ORGYN1  = .;
        R_ORGYN0  = .;
 END;
 ELSE DO;
       R_ORGYN1  =  -P_ORGYN1 ;
       R_ORGYN0  =  -P_ORGYN0 ;
       SELECT( F_ORGYN  );
          WHEN( '1'  ) R_ORGYN1  = R_ORGYN1  +1;
          WHEN( '0'  ) R_ORGYN0  = R_ORGYN0  +1;
       END;
 END;

****************************************************************;
******          END OF DECISION TREE SCORING CODE         ******;
****************************************************************;

